<root main_tree_to_execute="MainTree">
  <BehaviorTree ID="MainTree">
    <SequenceStar name="StartupWithManualLocalization">
      <Message msg="Starting the system bringup..."/>
      <SequenceStar name="Localization">
        <Message msg="Configuring and activating map_server"/>
        <StartNode node_name="map_server"/>
        <Message msg="Configuring and activating amcl"/>
        <StartNode node_name="amcl"/>
        <Fallback>
          <Timeout msec="10000">
            <ConditionalLoop key="is_localized" value="true">
              <Fallback>
                <Sequence>
                  <IsLocalized/>
                  <SetCondition key="is_localized" value="true"/>
                </Sequence>
                <RateController hz="1.0" skip_first="true">
                  <Message msg="Waiting for initial pose..."/>
                </RateController>
              </Fallback>
            </ConditionalLoop>
          </Timeout>
          <SequenceStar>
            <StopNode node_name="amcl"/>
            <StopNode node_name="map_server"/>
            <AlwaysFailure/>
          </SequenceStar>
        </Fallback>
      </SequenceStar>
      <SequenceStar name="BringUpRemainingNodes">
        <Message msg="Configuring and activating world_model"/>
        <StartNode node_name="world_model"/>
        <Message msg="Configuring and activating dwb_controller"/>
        <StartNode node_name="dwb_controller"/>
        <Message msg="Configuring and activating navfn_planner"/>
        <StartNode node_name="navfn_planner"/>
        <Message msg="Configuring and activating bt_navigator"/>
        <StartNode node_name="bt_navigator"/>
      </SequenceStar>
      <Message msg="The system is active"/>
    </SequenceStar>
  </BehaviorTree> 
</root>

